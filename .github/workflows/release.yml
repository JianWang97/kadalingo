name: Release

on:
  push:
    tags:
      - 'v*'  # å½“æ¨é€ v* æ ¼å¼çš„æ ‡ç­¾æ—¶è§¦å‘ (ä¾‹å¦‚: v1.0.0, v2.1.3)

jobs:
  release:
    runs-on: windows-latest  # ä½¿ç”¨ Windows ç¯å¢ƒæ„å»º exe æ–‡ä»¶
    
    permissions:
      contents: write  # éœ€è¦å†™æƒé™æ¥åˆ›å»º release
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build application
        run: npm run build
      
      - name: List build output (debug)
        run: dir build
      
      - name: Extract version from tag
        id: get_version
        shell: pwsh
        run: |
          $version = "${{ github.ref_name }}" -replace '^v', ''
          echo "version=$version" >> $env:GITHUB_OUTPUT
          echo "tag_name=${{ github.ref_name }}" >> $env:GITHUB_OUTPUT
      
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.get_version.outputs.tag_name }}
          name: å’”å“’ ${{ steps.get_version.outputs.tag_name }} - è¯­è¨€å­¦ä¹ å¥å­ç»ƒä¹ å·¥å…·
          body: |
            ğŸš€ **å’”å“’è¯­è¨€å­¦ä¹ å·¥å…·** ${{ steps.get_version.outputs.tag_name }} ç‰ˆæœ¬å‘å¸ƒ
            
            ## ğŸ“¥ ä¸‹è½½è¯´æ˜
            - **`kadalingo-${{ steps.get_version.outputs.version }}-Setup.exe`**: å®Œæ•´å®‰è£…åŒ…ï¼Œæ¨èå¤§å¤šæ•°ç”¨æˆ·ä½¿ç”¨
            - **`kadalingo ${{ steps.get_version.outputs.version }}.exe`**: ä¾¿æºç‰ˆï¼Œæ— éœ€å®‰è£…ç›´æ¥è¿è¡Œ
            
            ## âœ¨ ä¸»è¦åŠŸèƒ½
            - ğŸ¯ è¯­è¨€å­¦ä¹ å¥å­ç»ƒä¹ åŠŸèƒ½
            - ğŸŒ æ”¯æŒå¤šè¯­è¨€ç•Œé¢
            - ğŸ¨ ç°ä»£åŒ–çš„ç”¨æˆ·ç•Œé¢è®¾è®¡
            - ğŸ“± å“åº”å¼è®¾è®¡ï¼Œé€‚é…ä¸åŒå±å¹•å°ºå¯¸
            - ğŸ“ AI ç”Ÿæˆè¯¾ç¨‹å†…å®¹ï¼ŒåŠ©åŠ›é«˜æ•ˆå­¦ä¹ 
            
            ## ğŸ”§ å®‰è£…è¯´æ˜
            1. ä¸‹è½½å¯¹åº”çš„å®‰è£…åŒ…
            2. è¿è¡Œå®‰è£…ç¨‹åºå¹¶æŒ‰ç…§æç¤ºå®‰è£…
            3. å¯åŠ¨åº”ç”¨å¼€å§‹è¯­è¨€å­¦ä¹ ä¹‹æ—…
            
            å¦‚æœ‰é—®é¢˜ï¼Œè¯·è®¿é—® [é¡¹ç›®ä¸»é¡µ](https://github.com/JianWang6/kadalingo) æˆ–æäº¤ [Issue](https://github.com/JianWang6/kadalingo/issues)ã€‚
          files: |
            build/*.exe
          draft: false
          prerelease: false
          make_latest: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Upload build artifacts (for debugging)
        uses: actions/upload-artifact@v4
        if: failure()  # åªåœ¨å¤±è´¥æ—¶ä¸Šä¼ ï¼Œç”¨äºè°ƒè¯•
        with:
          name: build-artifacts
          path: build/
          retention-days: 7
